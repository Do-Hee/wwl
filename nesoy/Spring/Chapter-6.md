# AOP
- AOP를 바르게 이용하려면?
    - 등장배경과 스프링이 그것을 도입한 이유, 그 적용을 통해 얻을 수 있는 장점이 무엇인지에 대한 충분한 이해가 필요하다.
    - 그래야지만 AOP의 가치를 이해하고 효과적으로 사용할 방법을 찾을 수 있다.

## 6.1 트랜잭션 코드의 분리
- 트랜잭션 경계설정 코드와 비즈니스 코드가 한곳에 있으니 가독성이 떨어진다.
    - 따로 Method를 분리하는 작업을 통해 비즈니스 코드를 쉽게 볼 수 있는 장점이 있다.


- UserService를 인터페이스로 구현하여 비즈니스 로직과 트랜잭션를 두 가지의 관심사를 분리하여 구현한다.
    - 비즈니스 로직만 담당하는 UserServiceImpl
    - 트랜잭션만 관리하는 UserServiceTx

![No Image](/nesoy/Images/Spring/23.png)


## 6.2 고립된 단위 테스트
- 작은 단위의 테스트가 좋은 이유는 테스트가 실패하였을 때 그 원인을 찾기 쉽기 때문
- 비즈니스 로직은 굉장히 심플하지만?
    - 다른 오브젝트와 환경에 의존하고 있다면 작은 테스트 조차 하기 힘든 상황
    - DB가 함께 동작해야 하는 테스트는 작성하기 힘든 경우도 많다.
- 외부에 의존하는 오브젝트를 Mocking 처리한다.
    - 사용자 관리 로직을 검증하는 데 직접적으로 필요하지 않은 의존 오브젝트와 서비스를 모두 제거한 덕분

### 단위 테스트와 통합 테스트
- 단위 테스트
    - 중요한 것은 하나의 단위에 초점을 맞춘 테스트
    - 테스트 대역을 이용해 의존 오브젝트나 외부의 리소스를 사용하지 않도록 고립시켜서 테스트하는 것
- 통합 테스트
    - 두 개 이상의, 성격이나 계층이 다른 오브젝트가 연동하도록 만들어 테스트하거나, 또는 외부의 DB나 파일, 서비스등의 리소스가 참여하는 테스트

### 단위 테스트 & 통합 테스트 가이드라인
- 항상 단위 테스트를 먼저 고려한다.
- 하나의 클래스나 성격과 목적이 같은 긴밀한 몇 개를 모아서 `외부와의 의존관계를 모두 차단`하고 필요에 따라 Stub or Mock Object를 사용하여 테스트를 만든다.
- 단위 테스트는 테스트 작성도 간단하고 실행 속도도 빠르며 테스트 대상 외의 코드나 환경으로부터 테스트 결과에 영향을 받지도 않기 때문에 가장 빠른 시간에 효과적인 테스트를 작성하기에 유리하다.
- 외부 리소스를 사용해야만 가능한 테스트는 통합 테스트로 만든다.
- DAO는 DB까지 연동하는 테스트로 만드는 편이 효과적이다.
    - DB를 사용하는 테스트는 DB에 테스트 데이터를 준비하고 DB에 직접 확인을 하는 등의 부가적인 작업이 필요하다.
- 각각의 단위 테스트가 성공했더라도 여러 개의 단위를 연결해서 테스트하면 오류가 발생할 수도 있다.
    - 충분한 단위 테스트를 거친다면 통합 테스트에서 오류가 발생할 확률도 줄어들고 발생한다고 하더라도 쉽게 처리가 가능하다.
- 코드를 만들고 나서 오랜 시간이 지난 뒤에 작성하는 테스트는 테스트 대상 코드에 대한 이해가 떨어지기 때문에 불완전해지기 쉽고 작성하기도 번거롭다.
- 테스트가 없다면 코드의 품질은 점점 떨어지고 유연성과 확장성을 잃어갈지 모른다.

- <https://nesoy.github.io/articles/2018-09/Mockito>

## 6.3 다이내믹 프록시와 팩토리 빈