# 아이템15 - 클래스와 멤버의 접근 권한을 최소화하라

잘 설계된 컴포넌트와 그렇지 않은 컴포넌트의 가장 큰 차이점은 **정보 은닉, 캡슐화의 수준**. 캡슐화가 잘 된 컴포넌트는 오직 API를 통해서만 다른 컴포넌트와 소통하고 서로의 내부 동작 방식은 알지 못하며, 알 필요도 없는 것

### 정보 은닉의 장점
시스템 컴포넌트들을 서로 독립시켜 얻는 장점이 다수
- 여러 컴포넌트를 병렬 개발할 수 있기 때문에 **시스템 개발 속도 향상**
- 각 컴포넌트를 더 빨리 파악하여 디버깅할 수 있고, 다른 컴포넌트와의 교체 비용도 적기 때문에 **시스탬 관리 비용 감소**
- 다른 컴포넌트에 영향없이 개별적으로 성능 최적화하 가능하기 때문에 **성능 최적화에 도움**
- 외부에 거의 의존하지 않고 독립적으로 동작할 수 있는 컴포넌트라면 낯선 환경에서도 사용할 수 있는 가능성이 높기 때문에 **소프트웨어 재사용성 증가**
- 시스템 전체가 완성되지 않았어도 개별 컴포넌트 동작을 검증할 수 있기 때문에 **시스템 제작 난이도 감소**

## 자바의 접근 제어 메커니즘
자바가 제공하는 다양한 정보 은닉 장치 중 하나로, 클래스, 인터페이스, 멤버의 접근 허용 범위를 명시하는 방법

각 요소의 접근성은 그 **요소가 선언된 위치**와 **접근 제한자(private, protected, public)**로 지정되므로 접근 제한자를 제대로 활용하는 것이 정보 은닉의 핵심

기본 원칙은 **모든 클래스와 멤버의 접근성을 가능한 좁혀야 하는 것**

### 타입에 부여할 수 있는 접근 수준
- package-private (default) : 해당 패키지 내에서만 사용 가능
- ```public``` : 모든 곳에서 사용 가능(공개 API)

여기에서 말하는 타입이란 **톱 레벨 클래스(가장 바깥 클래스)와 인터페이스**

#### 범위 좁히는 팁
- 패키지 외부에서 쓸 이유가 없다면, 굳이 ```public```일 필요가 없다면 package-private으로 정의
  - 가장 중요한 점
  - API가 아닌 **내부 구현**이 되므로 언제든지 수정 가능
    - ```public```은 하위 호환을 위해 영원히 관리 필요
- 한 개의 클래스에서만 사용하는 package-private 타입은 해당 타입을 사용하는 클래스 내부에 중첩 클래스로 정의
  - 중첩 클래스로 정의 시 ```private static``` 지정
  - 오직 바깥 클래스에서만 접근할 수 있도록 범위를 축소하는 것

### 멤버에 부여할 수 있는 접근 수준(접근 범위 좁은 순)
- ```private``` : 멤버를 선언한 톱 레벨 클래스에서만 접근 가능
- package-private (default) : 멤버가 소속된 패키지 내 모든 클래스에서 접근 가능
- ```protected``` : package-private 범위를 포함해 상속 관계에 있는 하위 클래스에서 접근 가능
- ```public``` : 모든 곳에서 접근 가능

#### 범위 좁히는 팁
1. 클래스의 공개 API(```public```)를 세심히 설계
2. 공개 API 외 모든 멤버는 ```private``` 지정
3. 필요 시 ```private``` 제한자를 제거해 package-private으로 변경
4. 제한자 범위를 넓혀야 할 일이 많다면 컴포넌트 분해 고려

> 단, Serializable 구현 클래스는 private이나 package-private도 의도치 않게 공개 API가 될 수 있음

- ```protected```는 특수한 경우인데, ```public``` 클래스에서 ```protected``` 멤버 선언 시 ```public```과 마찬가지로 공개 API가 되기 때문에 영원히 관리해주어야 하며, 내부 동작 방식을 문서에 적어 사용자에게 공유해야 할 수도 있으므로 적을수록 좋은 멤버 제한자


## 주의할 점
- 상위 클래스의 메소드 재정의 시 **멤버 접근 수준을 상위에서보다 좁게 설정할 수 없는 점**
  - 이 제약이 없다면 리스코프 치환 원칙에 위배
  - 이 제약을 어기면 하위 클래스 컴파일 시 에러 발생
  - ex. 클래스는 인터페이스 구현 시 모든 메소드를 ```public```으로 재정의
- **단지 테스트하려는 목적으로 접근 범위를 넓히지 말 것**
  - ```private``` 멤버를 package-private 까지 넓히는 것은 허용되지만 그 이상은 금지
  - 테스트만을 위해 공개 API로 만드는 것은 부적절
- **```public``` 클래스의 인스턴스 필드는 가급적 ```public``` 외 제한자 사용**
  - ```public```으로 선언 시 불변식을 보장할 수 없고, 외부에서 함부로 접근하여 값 변경 가능(스레드 안전하지 않음)
  - 또한, 필드 수정 시 락 획득 같은 다른 작업 수행 불가능
  - 한 가지 예외는 **상수처럼 사용하기 위해 ```public static final```로 지정하는 경우 ```public``` 가능**
    - **단, 반드시 기본 타입이나 불변 객체를 참조**하게 할 것
    - 클래스에 해당 제한자로 지정된 배열 필드를 두거나 필드를 반환하는 메소드 제공은 금지
    ```JAVA
    // Thing 요소 자체는 수정 가능하므로 불변이 아님
    public static final Thing[] VALUES = { . . . };
    ```
    ```JAVA
    // 해결책 1 (private으로 바꾸고 불변 리스트 추가)
    private static final Thing[] PRIVATE_VALUES = { . . . };
    public static final List<Thing> VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));

    // 해결책 2 (private으로 바꾸고 방어적 복사)
    private static final Thing[] PRIVATE_VALUES = { . . . };
    public static final Thing[] values() {
      return PRIVATE_VALUES.clone();
    }
    ```

## 자바 9에서 추가된 접근 제한 수준
**모듈 시스템** 개념이 도입되며 두 가지 암묵적인 접근 수준 추가
- 패키지가 클래스의 묶음이듯, 모듈은 패키지의 묶음 (모듈 > 패키지 > 클래스)
- 모듈 내 패키지 중 공개(export)할 것을 ```module-info.java```에 선언하며, ```protected```나 ```public``` 타입/멤버일지라도, 모듈이 패키지를 공개 처리 하지 않았다면 모듈의 외부에서는 접근 불가능
- 따라서 추가된 두 가지 암묵적 접근 수준이란, 모듈 내에서만 사용 가능한 ```protected```, ```public``` 제한자인 것
- 다만 모듈의 장점을 누리려면 해야 할 일이 많고 사용하기 다소 까다롭기 때문에 꼭 필요한 경우가 아니라면 당분간은 사용 자제

대표적으로 사용된 예가 JDK 자체. 자바 라이브러리가 공개하지 않은 패키지들은 모두 해당 모듈 외부에서는 절대로 접근 불가
