# 아이템10 - equals는 일반 규약을 지켜 재정의하라

### equals를 재정의해야 하는 경우
각 객체의 고유 식별이 아니라 '논리적 동치성'을 확인해야 하는데, 상위 클래스의 ```equals```가 논리적 동치성을 비교하도록 재정의되어 있지 않은 경우
> - '논리적 동치성' : 두 문장이나 수식이 논리적으로 같은 것. 두 인스턴스의 모든 필드가 가진 '값'이 서로 동일한 경우를 의미
> - '물리적 동치성' : 인스턴스 고유 식별성을 의미(실제 저장된 '주소'값)

- 주로 값 클래스들이 이 경우에 해당(```Integer```, ```String```)
- ```equals```를 재정의함으로써 값의 동치성을 비교하면 객체를 ```Map```의 키나 ```Set```의 원소로도 사용 가능

<br />

### equals를 재정의하지 않아도 되는 경우
값 클래스라해도, 값이 같은 인스턴스가 둘 이상 만들어지지 않음이 보장되는 경우 (논리적으로 동치인 인스턴스가 둘 이상 만들어지지 않는 경우, 논리적 동치성과 객체 식별성이 똑같은 의미)
- 정적 팩토리 메소드를 활용해 인스턴스 통제 클래스를 만들 때
- ```Enum```

<br />

### equals를 재정의하면 안되는 경우
재정의하기 쉬워보이지만 중간중간 함정이 있기 때문에 주의해야 하며, 재정의하지 않는 것이 최선일 때가 있음
- **각 인스턴스가 본질적으로 고유한 경우**
  - 값을 표현하는게 아니라 동작하는 객체를 표현하는 클래스일 때
  - ex. ```Thread```
- **인스턴스의 '논리적 동치성'을 검사할 필요가 없을 경우**
  - ex. ```Pattern``` : ```equals```를 재정의해서 두 ```Pattern```의 인스턴스가 같은 정규표현식을 나타내는지 검사
- **상위 클래스에서 재정의한 ```equals```가 하위 클래스에도 알맞을 경우**
  - ex. 대부분의 ```Set``` 구현체는 ```AbstractSet```의 ```equals```를 상속받아 사용(```List```, ```Map```도 동일)
- **클래스가 ```private```이거나 package-private이고, ```equals``` 메소드를 호출할 일이 없는 경우**
  - 만약 ```equals```가 실수로라도 호출되는 것을 막고 싶다면
  ```JAVA
  @Override
  public boolean equals(Object o) {
    throw new AssertionError(); // 호출 금지
  }
  ```

<br />

## equals 일반 규약
- **반사성(reflexivity)** : ```null```이 아닌 모든 참조 값 ```x```에 대해, ```x.equals(x)```는 ```true```
- **대칭성(symmetry)** : ```null```이 아닌 모든 참조 값 ```x```, ```y```에 대해, ```x.equals(y)```가 ```true```면 ```y.equals(x)```도 ```true```
- **추이성(transitivity)** : ```null```이 아닌 모든 참조 값 ```x```, ```y```, ```z```에 대해 ```x.equals(y)```가 ```true```고 ```y.equals(z)```도 ```true```면 ```x.equals(z)```도 ```true```
- **일관성(consistency)** : ```null```이 아닌 모든 참조 값 ```x```, ```y```에 대해, ```x.equals(y)```를 반복해서 호출하면 항상 ```true```를 반환하거나 항상 ```false```를 반환
- **null-아님** : ```null```이 아닌 모든 참조 값 ```x```에 대해, ```x.equals(null)```은 ```false```

규약을 어기면 프로그램이 이상하게 동작할 수 있고, 문제 원인을 찾기도 어려울 것

<br />

### 반사성

<br />

### 대칭성

<br />

### 추이성

<br />

### 일관성

<br />

### null-아님

<br />

## 구현 후 테스트
반사성, 대칭성, 추이성을 잘 지키는지 테스트 코드 작성 필요(일관성과 null-아님은 자연스럽게 ㅇㅇ되는 편)

### AutoValue
구글에서 만들었으며, 저자피셜 가장 깔끔하게 재정의 코드를 생성해주는 라이브러리

또는 IDE가 제공하는 자동완성 기능을 활용하는 것도 좋은 방법

<br />

## 주의사항
- ```equals```를 재정의할 땐 반드시 ```hashCode```도 같이 재정의 (아이템11)
- 너무 복잡하게 해결하려하지 말고, 필드의 동치성만 검사해도 충분
  - 일반적으로 별칭은 검사하지 않음
  - ex. ```File``` 클래스 같은 경우, 심볼릭 링크로 동치성 검사를 하지 않음
- 재정의할 때 반드시 ```@Override```를 붙이고, 메소드 인자에 ```Object```가 아닌 다른 타입을 작성하지 말 것
